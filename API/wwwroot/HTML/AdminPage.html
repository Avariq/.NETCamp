<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="utf-8" />
    <title>AnimeLib</title>
    <link href="../CSS/main.css" rel="stylesheet" />
    <link href="../CSS/adminpage.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Kurenaido&display=swap" rel="stylesheet">
    <script src="../JS/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <ul class="menu">
                <li><a href="../index.html"> Back </a></li>
            </ul>
        </div>
    </header>
    <div class="ap-container">
        <div class="option-container">
            <ul class="ap-option-menu">
                <li id="new-anime">New Anime</li>
                <li id="new-arc">New Arc</li>
                <li id="new-episode">New Episode</li>
            </ul>
        </div>
        <div id="new-anime-block">
            <div class="new-anime-block">
                <div class="anime-main">
                    <div>
                        <p>Title:</p>
                        <input id="anime-name" type="text" name="" value="" />
                    </div>
                    <div>
                        <p>Year:</p>
                        <input id="anime-year" type="text" name="" value="" />
                    </div>
                    <div>
                        <p>Episodes:</p>
                        <input id="anime-episodes" type="text" name="" value="" />
                    </div>
                </div>
                <div class="anime-description-block">
                    <p>Description:</p>
                    <textarea id="anime-description"></textarea>
                </div>
                <div class="anime-status-block">
                    <p>Status:</p>
                    <div class="status-choice">
                        <input type="radio" id="s-released" name="status" value="" />
                        <label for="s-released">Released</label> <br />
                        <input type="radio" id="s-ongoing" name="status" value="" />
                        <label for="s-ongoing">Ongoing</label> <br />
                        <input type="radio" id="s-announced" name="status" value="" />
                        <label for="s-announced">Announced</label> <br />
                    </div>
                </div>
                <div class="anime-ar-block">
                    <p>Age Restriction:</p>
                    <div class="ar-choice">
                        <label><input type="radio" id="ar-g" name="ar" value="" />G (0+)</label>
                        <label><input type="radio" id="ar-pg12" name="ar" value="" />PG12 (12+)</label>
                        <label><input type="radio" id="R15" name="ar" value="" />R15 (15+)</label>
                        <label><input type="radio" id="r18" name="ar" value="" />R18 (18+)</label>
                    </div>
                </div>
                <div class="anime-genres-block">
                    <p>Genres:</p>
                    <div class="genre-choice">
                        <label><input type="checkbox" id="g-seinen" />Seinen</label>
                        <label><input type="checkbox" id="g-ninja" />Ninja</label>
                        <label><input type="checkbox" id="g-swords" />Swords</label>
                        <label><input type="checkbox" id="g-action" />Action</label>
                    </div>
                </div>
                <div class="upload-image-block">
                    <label>Select an image:<input type="file" id="img-file" name="Img" accept="image/*" /></label>
                </div>
                <div class="anime-submit-block">
                    <input id="anime-submit" class="anime-submit" type="submit" value="Submit" />
                </div>
            </div>
            
        </div>
        
        <div id="new-arc-block">
            <div class="new-arc-block">
                <form id="new-arc-form">
                    <div class="arc-anime-title">
                        <label>Anime:<input id="arc-anime-title" type="text" /></label>
                    </div>
                    <div class="arc-arc-title">
                        <label>New Arc:<input id="arc-arc-title" type="text" /></label>
                    </div>
                    <div class="arc-submit-block">
                        <input id="arc-submit" class="arc-submit" type="submit" value="Submit" />
                    </div>
                </form>
            </div>
        </div>

        <div id="new-episode-block">
            <div class="new-episode-block">
                <div class="ep-anime-block">
                    <label>Anime name:<input id="ep-anime-title" type="text" /></label>
                    <label>Arc name:<input id="ep-arc-title" type="text" /></label>
                </div>
                <div class="ep-episode-block">
                    <label>Episode name:<input id="ep-title" type="text" /></label>
                    <label>Episode length (min):<input id="ep-length" type="text" /></label>
                </div>
                <div class="ep-submit-block">
                    <input id="ep-submit" class="ep-submit" type="submit" value="Submit" />
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            
        })

        $("#new-anime").click(function () {
            $("#new-arc").removeClass("viewing");
            $("#new-episode").removeClass("viewing");
            $("#new-arc-block").hide();
            $("#new-episode-block").hide();
            $("#new-anime-block").fadeIn();
            $("#new-anime").addClass("viewing");
        });
        $("#new-arc").click(function () {
            $("#new-anime").removeClass("viewing");
            $("#new-episode").removeClass("viewing");
            $("#new-anime-block").hide();
            $("#new-episode-block").hide();
            $("#new-arc-block").fadeIn();
            $("#new-arc").addClass("viewing");
        });
        $("#new-episode").click(function () {
            $("#new-anime").removeClass("viewing");
            $("#new-anime-block").hide();
            $("#new-arc-block").hide();
            $("#new-arc").removeClass("viewing");
            $("#new-episode-block").fadeIn();
            $("#new-episode").addClass("viewing");
        });

        jQuery.extend({
            getAnimeId: function (animeTitle) {
                var Id = -1;
                $.ajax({
                    type: "get",
                    url: "https://localhost:5001/Main/GetAnimeIdByTitle" + "/" + animeTitle,
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        Id = data;
                    },
                    error: function (errorThrown) {
                        console.log(errorThrown);
                    }
                });
                return Id;
            }
        });
        jQuery.extend({
            getAnimeTitles: function () {
                var animes = null;
                $.ajax({
                    type: 'get',
                    url: 'https://localhost:5001/Main/GetAnimeTitles',
                    dataType: 'json',
                    async: false,
                    success: function (data) {
                        animes = data;
                    },
                    error: function (errorThrown) {
                        console.log(errorThrown);
                    }
                });
                return animes;
            }
        });
        jQuery.extend({
            getArcTitles: function (animeId) {
                var arcs = null;
                $.ajax({
                    type: 'get',
                    url: 'https://localhost:5001/Main/GetArcs/' + animeId,
                    dataType: 'json',
                    async: false,
                    success: function (data) {
                        arcs = data;
                    },
                    error: function (errorThrown) {
                        console.log(errorThrown);
                    }
                });
                return arcs;
            }
        });

        var animes = $.getAnimeTitles();
        $('#arc-anime-title').autocomplete({
            source: animes
        });

        $("#new-arc-form").submit(function (event) {
            event.preventDefault();

            var $form = $(this);
            var $inputs = $form.find("input");

            $inputs.prop("disabled", true);

            var animeTitle = $("#arc-anime-title").val().toString();
            if (jQuery.inArray(animeTitle, animes) == -1) {
                console.error("Such anime does not exist.");
                $inputs.prop("disabled", false);
                return;
            }
            var Id = $.getAnimeId(animeTitle);
            console.log("Retrieved id: " + Id);

            var new_arc = $("#arc-arc-title").val().toString();
            var arcs = $.getArcTitles(Id);

            if (jQuery.inArray(new_arc, arcs) !== -1) {
                console.error("Such arc already exists.");
                $inputs.prop("disabled", false);
                return;
            }

            var request = $.ajax({
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                url: "https://localhost:5001/Main/CreateArc",
                type: "post",
                dataType: "json",
                async: false,
                data: JSON.stringify({"animeId": Id, "name": new_arc})
            });
            request.done(function (response, textStatus, jqXHR) {
                console.log("Frontend: Success 201");
            });

            request.fail(function (jqXHR, textStatus, errorThrown) {
                console.error(
                    "The following error occurred: " +
                    textStatus, errorThrown
                );
            });

            request.always(function () {
                $inputs.prop("disabled", false);
            });
        })

    </script>
</body>
</html>